var home=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function s(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t){e.appendChild(t)}function c(e,t,n){e.insertBefore(t,n||null)}function l(e){e.parentNode.removeChild(e)}function i(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function u(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function g(){return d(" ")}function f(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function h(e){return function(t){return t.preventDefault(),e.call(this,t)}}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function p(e,t){t=""+t,e.data!==t&&(e.data=t)}function y(e,t){(null!=t||e.value)&&(e.value=t)}function v(e,t,n,o){e.style.setProperty(t,n,o?"important":"")}function _(e,t,n){e.classList[n?"add":"remove"](t)}let b;function w(e){b=e}const $=[],k=[],q=[],O=[],x=Promise.resolve();let S=!1;function j(e){q.push(e)}function D(){const e=new Set;do{for(;$.length;){const e=$.shift();w(e),T(e.$$)}for(;k.length;)k.pop()();for(let t=0;t<q.length;t+=1){const n=q[t];e.has(n)||(n(),e.add(n))}q.length=0}while($.length);for(;O.length;)O.pop()();S=!1}function T(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(j)}}const I=new Set;function E(e,t){-1===e.$$.dirty[0]&&($.push(e),S||(S=!0,x.then(D)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function C(r,a,c,l,i,u,d=[-1]){const g=b;w(r);const f=a.props||{},h=r.$$={fragment:null,ctx:null,props:u,update:e,not_equal:i,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(g?g.$$.context:[]),callbacks:n(),dirty:d};let m=!1;var p,y;h.ctx=c?c(r,f,(e,t,n=t)=>(h.ctx&&i(h.ctx[e],h.ctx[e]=n)&&(h.bound[e]&&h.bound[e](n),m&&E(r,e)),t)):[],h.update(),m=!0,o(h.before_update),h.fragment=!!l&&l(h.ctx),a.target&&(a.hydrate?h.fragment&&h.fragment.l(function(e){return Array.from(e.childNodes)}(a.target)):h.fragment&&h.fragment.c(),a.intro&&((p=r.$$.fragment)&&p.i&&(I.delete(p),p.i(y))),function(e,n,r){const{fragment:a,on_mount:c,on_destroy:l,after_update:i}=e.$$;a&&a.m(n,r),j(()=>{const n=c.map(t).filter(s);l?l.push(...n):o(n),e.$$.on_mount=[]}),i.forEach(j)}(r,a.target,a.anchor),D()),w(g)}function N(e,t,n){const o=e.slice();return o[33]=t[n],o}function K(e,t,n){const o=e.slice();return o[36]=t[n],o[38]=n,o}function H(e){let t,n,o,s,r,i,h,y,_,b,w,$,k,q,O=e[36].name+"",x=e[36].last_msg+"";return{c(){t=u("label"),n=u("div"),o=u("input"),r=g(),i=u("ul"),h=u("li"),y=d(O),_=g(),b=u("li"),w=d(x),k=g(),m(o,"type","radio"),m(o,"class","convo_radio_wrapper svelte-1qgd5u6"),o.__value=s=e[38],o.value=o.__value,e[30][0].push(o),m(h,"class","header svelte-1qgd5u6"),m(b,"class","msg svelte-1qgd5u6"),v(i,"list-style-type","none"),m(n,"class","convo_box svelte-1qgd5u6"),m(n,"style",$=e[38]==e[7]?"background-color:#cef":e[38]%2==0?"background-color:#ddd":""),q=f(o,"change",e[29])},m(s,l){c(s,t,l),a(t,n),a(n,o),o.checked=o.__value===e[7],a(n,r),a(n,i),a(i,h),a(h,y),a(i,_),a(i,b),a(b,w),a(t,k)},p(e,t){128&t[0]&&(o.checked=o.__value===e[7]),1&t[0]&&O!==(O=e[36].name+"")&&p(y,O),1&t[0]&&x!==(x=e[36].last_msg+"")&&p(w,x),128&t[0]&&$!==($=e[38]==e[7]?"background-color:#cef":e[38]%2==0?"background-color:#ddd":"")&&m(n,"style",$)},d(n){n&&l(t),e[30][0].splice(e[30][0].indexOf(o),1),q()}}}function L(e){let t,n,o,s,r,i,g,f=e[33].time+"",h=e[33].sender+"",y=e[33].contents+"";return{c(){t=u("li"),n=d(f),o=d("@"),s=d(h),r=d("> "),i=d(y),m(t,"style",g=e[33].from_you?"color:#f55;":"")},m(e,l){c(e,t,l),a(t,n),a(t,o),a(t,s),a(t,r),a(t,i)},p(e,o){2&o[0]&&f!==(f=e[33].time+"")&&p(n,f),2&o[0]&&h!==(h=e[33].sender+"")&&p(s,h),2&o[0]&&y!==(y=e[33].contents+"")&&p(i,y),2&o[0]&&g!==(g=e[33].from_you?"color:#f55;":"")&&m(t,"style",g)},d(e){e&&l(t)}}}function M(t){let n,s,r,p,b,w,$,k,q,O,x,S,j,D,T,I,E,C,M,P,A,R,J,X,B,U,Y,z,F=t[0],G=[];for(let e=0;e<F.length;e+=1)G[e]=H(K(t,F,e));let Q=t[1],V=[];for(let e=0;e<Q.length;e+=1)V[e]=L(N(t,Q,e));return{c(){n=u("div"),s=g(),r=u("div"),p=u("form"),b=d("User(s):"),w=u("input"),$=d("\n\t\tChat Name:"),k=u("input"),q=g(),O=u("button"),O.textContent="Create Chat",x=g(),S=u("div"),j=u("div"),D=u("div"),T=u("button"),T.textContent="+",I=g(),E=u("div");for(let e=0;e<G.length;e+=1)G[e].c();C=g(),M=u("div"),P=u("div"),A=u("ul");for(let e=0;e<V.length;e+=1)V[e].c();R=g(),J=u("div"),X=u("form"),B=u("input"),U=g(),Y=u("input"),m(n,"class","greyout_overlay svelte-1qgd5u6"),_(n,"grey_show",t[4]),m(w,"type","text"),m(w,"placeholder","steve85, joeseph42, ..."),m(k,"type","text"),m(k,"placeholder","friday sesh"),m(O,"type","submit"),m(r,"class","add_convo_form_wrapper svelte-1qgd5u6"),_(r,"show",t[4]),m(T,"class","svelte-1qgd5u6"),m(D,"class","add_convo_wrapper svelte-1qgd5u6"),m(E,"class","conversation_wrapper svelte-1qgd5u6"),m(j,"class","column left svelte-1qgd5u6"),v(A,"list-style-type","none"),m(P,"class","messages svelte-1qgd5u6"),m(B,"type","text"),m(B,"class","message_input svelte-1qgd5u6"),m(Y,"type","submit"),v(Y,"display","none"),v(X,"height","100%"),m(J,"class","input_area svelte-1qgd5u6"),m(M,"class","column right svelte-1qgd5u6"),m(S,"class","row svelte-1qgd5u6"),z=[f(n,"click",t[9]),f(w,"input",t[27]),f(k,"input",t[28]),f(p,"submit",h(t[10])),f(T,"click",t[8]),f(B,"input",t[32]),f(X,"submit",h(t[11]))]},m(e,o){c(e,n,o),c(e,s,o),c(e,r,o),a(r,p),a(p,b),a(p,w),y(w,t[5]),a(p,$),a(p,k),y(k,t[6]),a(p,q),a(p,O),c(e,x,o),c(e,S,o),a(S,j),a(j,D),a(D,T),a(j,I),a(j,E);for(let e=0;e<G.length;e+=1)G[e].m(E,null);a(S,C),a(S,M),a(M,P),a(P,A);for(let e=0;e<V.length;e+=1)V[e].m(A,null);t[31](P),a(M,R),a(M,J),a(J,X),a(X,B),y(B,t[3]),a(X,U),a(X,Y)},p(e,t){if(16&t[0]&&_(n,"grey_show",e[4]),32&t[0]&&w.value!==e[5]&&y(w,e[5]),64&t[0]&&k.value!==e[6]&&y(k,e[6]),16&t[0]&&_(r,"show",e[4]),129&t[0]){let n;for(F=e[0],n=0;n<F.length;n+=1){const o=K(e,F,n);G[n]?G[n].p(o,t):(G[n]=H(o),G[n].c(),G[n].m(E,null))}for(;n<G.length;n+=1)G[n].d(1);G.length=F.length}if(2&t[0]){let n;for(Q=e[1],n=0;n<Q.length;n+=1){const o=N(e,Q,n);V[n]?V[n].p(o,t):(V[n]=L(o),V[n].c(),V[n].m(A,null))}for(;n<V.length;n+=1)V[n].d(1);V.length=Q.length}8&t[0]&&B.value!==e[3]&&y(B,e[3])},i:e,o:e,d(e){e&&l(n),e&&l(s),e&&l(r),e&&l(x),e&&l(S),i(G,e),i(V,e),t[31](null),o(z)}}}function P(e,t,n){const o=localStorage.getItem("authToken"),s=localStorage.getItem("publicKey"),r=localStorage.getItem("privateKey"),a=(e,t)=>(console.log(t),new Promise((n,o)=>{let s=new XMLHttpRequest;s.open("POST",t,!0),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(e)),s.onreadystatechange=()=>{if(s.readyState!=XMLHttpRequest.DONE)return;200!==s.status&&o(new Error("Error "+s.status.toString()));let e=JSON.parse(s.response);e.hasOwnProperty("error")&&o(new Error(e.error)),n(e)}}).catch(e=>{console.error(e.message)}));let c=localStorage.getItem("username");if(null==c){(async()=>{let e=a({authToken:o},"/user_req");try{c=await e}catch(e){console.error(e.message)}})()}let l=[];const i={id:-1,name:"default_name",last_msg:"default_msg",keys:{}};let u=[];const d={sender:"username-here",contents:"contents of message goes here",time:"formatted time string goes here",from_you:!1};let g,f;const h=e=>(1900+e.getYear()).toString()+"-"+("0"+(1+e.getMonth()).toString()).slice(-2)+"-"+e.getDate().toString()+" "+("0"+e.getHours().toString()).slice(-2)+":"+("0"+e.getMinutes().toString()).slice(-2)+":"+("0"+e.getSeconds().toString()).slice(-2),m=async()=>{let e,t={authToken:o},s=a(t,"/convo_req");try{e=await s}catch(e){return void console.error(e.message)}for(let n=0;n<e.conversationObjects.length;n++){let r,c=Object.create(i);c.id=e.conversationObjects[n].id,c.name=e.conversationObjects[n].name,c.last_msg=e.conversationObjects[n].last_msg_digest,t={authToken:o,conversationID:c.id},s=a(t,"/keys_req");try{r=await s}catch(e){console.error(e.message);continue}c.keys=r,l.push(c)}n(0,l)};m();let p=!1;let y,v;let _=-1;const b=async e=>{let t,s=a({authToken:o,conversationID:e},"/messages_req");try{t=await s}catch(e){return void alert(e.message)}n(1,u=[]);let r=t.messageObjects;for(let e=0;e<r.length;e++){let t=Object.create(d);t.sender=r[e].sender,t.contents=r[e].digest,t.time=h(new Date(r[e].time)),t.from_you=c===r[e].sender,u.push(t)}n(1,u)},w=e=>{-1!=e&&(n(0,l),b(l[e].id))},$=async(e,t)=>{const n={authToken:o,conversationID:e.id,digests:{userDigests:[],deviceDigests:[]}};for(let o=0;o<e.keys.userKeys.length;o++)n.digests.userDigests.push({id:e.keys.userKeys[o].id,digest:t});for(let o=0;o<e.keys.deviceKeys.length;o++)n.digests.deviceDigests.push({id:e.keys.deviceKeys[o].id,digest:t});let s,r=a(n,"/msg_create");try{s=await r}catch(e){return void alert(e.message)}};let q=Object.create(d);q.sender="seamooo",q.contents="wow awesome message you got there",q.time="1997-03-11 11:20:24",q.from_you=!0,u.push(q),q=Object.create(d),q.sender="other",q.contents="average message",q.time="1997-03-11 11:20:30",q.from_you=!1,u.push(q),q=Object.create(d),q.sender="seamooo",q.contents="ehh it was kinda cool I guess",q.time="1997-03-11 11:20:40",q.from_you=!0,u.push(q),q=Object.create(d),q.sender="other",q.contents="yeah whatever",q.time="1997-03-11 11:20:50",q.from_you=!1,u.push(q),l=l,u=u;return e.$$.update=()=>{128&e.$$.dirty[0]&&w(_)},[l,u,g,f,p,y,v,_,()=>{n(4,p=!0)},()=>{n(4,p=!1)},async()=>{let e=y.replace(/ /g,"").split(",");e.push(c);let t={authToken:o,participants:e};v.length>0&&(t.name=v);let s,r=a(t,"/conversation_create");try{s=await r}catch(e){return void alert(e.message)}const u=s.conversationID,d=s.name;t={authToken:o,conversationID:u},r=a(t,"/keys_req");try{s=await r}catch(e){return void alert(e.message)}const g=s;t={authToken:o,conversationID:u},r=a(t,"/last_msg_req");try{s=await r}catch(e){return void alert(e.message)}const f=s.digest,h=Object.create(i);h.id=u,h.name=d,h.last_msg=f,h.keys=g,l.unshift(h),n(0,l),n(4,p=!1)},()=>{let e=l[_];if(console.log(f),0==f.length||!f)return;let t=Object.create(d);$(e,f),t.sender=c,t.contents=f,t.time=h(new Date),t.from_you=!0,u.push(t),n(1,u),n(3,f=""),n(2,g.scrollTop=g.scrollHeight,g)},c,q,o,s,r,a,i,d,void 0,h,{id:-1,digest:"deadd0d0"},m,b,w,$,function(){y=this.value,n(5,y)},function(){v=this.value,n(6,v)},function(){_=this.__value,n(7,_)},[[]],function(e){k[e?"unshift":"push"](()=>{n(2,g=e)})},function(){f=this.value,n(3,f)}]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}{constructor(e){super(),C(this,e,P,M,r,{},[-1,-1])}}({target:document.body,props:{}})}();
//# sourceMappingURL=home.js.map
